<div class="loader" *ngIf="this.loading"></div>
<div *ngIf="!this.loading">

  <div class="main-subscription  container">
    <div class="d-flex justify-content-center">
      <div class="alert" [ngClass]="'alert-' + alertType" role="alert"
        style="width: calc(100% - 280px); z-index: 20000; margin: 5px 0px; position: fixed; left: 260px;"
        *ngIf="showAlert">

        {{ alertMessage }}

        <button type="button" class="btn-close" (click)="showAlert = false" aria-label="Close"
          style="float: right;"></button>
      </div>

    </div>
    <div class="option d-flex flex-row bd-highlight " style="width: 100%; margin: 30px auto;" *ngIf="!paymentIntiated">
      <span [ngClass]="{'selected-option':(currOption==1)}" (click)="onClick(1)">Manage Subscription </span>
      <span [ngClass]="{'selected-option':(currOption==2)}" (click)="onClick(2)">Available Plans </span>

    </div>

    <div *ngIf="currOption==2">
      <div class="card" *ngIf="curr_phase==1">
        <div class="logo d-flex justify-content-center" style=" background-color: #bac9bbeb;">
          <div style="display: flex; flex-direction: column;">
            <label class="title">Basic Duo</label>
            <label class="price" *ngIf="basicIsMonthly">${{curr_amount}}<sub>/mo</sub></label>
            <label class="price" *ngIf="!basicIsMonthly"> <span
                style="text-decoration:line-through;">${{this.basicMonthlyCharge}}</span>${{this.basicAnnualChargeInMonth}}
              <sub>/mo</sub></label>
            <label *ngIf="!basicIsMonthly" style="margin-top: 5px; font-size: large;">{{basicAnnualDiscount}}%
              Discount</label>
            <label class="person">per person</label>
          </div>
        </div>
        <div class="tab-container">
          <button class="tab tab--1" (click)="basicMonthClick()">Monthly</button>
          <button class="tab tab--2" (click)="basicAnnualClick()">Annual</button>
          <div class="indicator" [ngClass]="{'selected-tab':!basicIsMonthly}"></div>
        </div>
        <div class="d-flex justify-content-center">
          <!-- <button
            style="background-color: #bac9bbeb; border: #bac9bbeb; width: 70%;height: 30px; border-radius: 10px; bottom: 0; margin-bottom: 10px; position: absolute;"
            data-toggle="modal" data-target="#addPerson" (click)="checkUpcomingPlan()">Select
          </button> -->
          <button
            style="background-color: #bac9bbeb; border: #bac9bbeb; width: 70%;height: 30px; border-radius: 10px; bottom: 0; margin-bottom: 10px; position: absolute;"
            (click)="checkUpcomingPlan()">Select
          </button>
            
        </div>
        <div>
          <ul class="lists">
            <li class="list">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                viewBox="0 0 16 16">
                <path
                  d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
              </svg>
              <div> Connect 80 websites </div>
            </li>
            <li class="list">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                viewBox="0 0 16 16">
                <path
                  d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
              </svg>
              <div> Track up to 50 credit cards </div>
            </li>
            <li class="list">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                viewBox="0 0 16 16">
                <path
                  d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
              </svg>
              <div> Export up to 12 months data </div>
            </li>
            <li class="list">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                viewBox="0 0 16 16">
                <path
                  d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
              </svg>
              <div> Cloud service 24/7 </div>
            </li>
            <li class="list">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                viewBox="0 0 16 16">
                <path
                  d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
              </svg>
              <div> Connect 80 websites </div>
            </li>
            <li class="list">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                viewBox="0 0 16 16">
                <path
                  d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
              </svg>
              <div> Connect up to 5 bank accounts </div>
            </li>
          </ul>
        </div>
      </div>

      <!-- <div class="card">
      
        <div class="logo d-flex justify-content-center" style=" background-color: #63e257;">
            <div style="display: flex; flex-direction: column;">
            <label class="title" >Intermediate Duo</label>
            <label class="price"><sup>$</sup>29<sub>/mo</sub></label>
            </div>
        </div>
        <div class="tab-container">
            <button class="tab tab--1">Monthly</button>
            <button class="tab tab--2">Annual</button>
            <div class="indicator"></div>
          </div>
    </div>

    <div class="card">
        <div class="logo d-flex justify-content-center" style=" background-color: #FEB347;">
            <div style="display: flex; flex-direction: column;">
            <label class="title">Premium Duo</label>
            <label class="price"><sup>$</sup>49<sub>/mo</sub></label>
            </div>
        </div>
        <div class="tab-container">
            <button class="tab tab--1">Monthly</button>
            <button class="tab tab--2">Annual</button>
            <div class="indicator"></div>
          </div>
    </div> -->
      <div class=" d-flex justify-content-center" style="margin-top: 50px; width:100% ;" *ngIf="curr_phase==2">
        <div style="margin-right: 30px;display: flex; justify-content:center; display: flex; flex: none;">
          <a (click)="onBack()"
            style="margin-right: 30px; font-size: large; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;"
            id="subscription-back">&larr; Back</a>

        </div>
        <div>
          <div class="curr-plan-card">
            <div class="curr-plan-title">Your Selected Plan</div>
            <div class="curr-plan">Basic</div>

          </div>



          <div class="plan-details-card">


            <table style="width: 30%;">
              <tr>
                <td>Total Person:</td>
                <td>{{ person }} Person</td>
              </tr>
              <tr>
                <td>Subscription Type:</td>
                <td>{{ (basicIsMonthly==true) ? 'Monthly' : 'Annual' }}</td>

              </tr>
              <tr>
                <td>Expiry Date:</td>
                <td>{{ expiryDate | date: 'MMM d, y' }}</td>
              </tr>
              <tr>
                <td class="curr-plan-totalAmount">Total Amount:</td>
                <td>${{ res_amount }}</td>
              </tr>
            </table>

          </div>
        
          <div class="savedCard d-flex justify-content-center" >
            <!-- <div *ngIf="myCard">
              <h2>Saved Card</h2>
              <div id="card-span"  *ngIf="!editCard">
                <div *ngFor="let card of myCard" class="d-flex justify-content-between">
                  <div>
                    <div>
                      <span>
                        <img [src]="getCardLogo(card?.brand)" alt="{{ card?.brand }}" class="card-logo" />
                        ending in {{ card?.last4 }}
                      </span>
                    </div>
                    <div style="color: gray; font-weight: 400; font-size: small;">
                      <span>Expiry Date: </span> {{ ('0' + (card?.expMonth || 0)).slice(-2) }} / {{ card?.expYear }}
                    </div>
                  </div>
                  <div>
                    <button class="btn btn-success mt-2" (click)="payWithSavedCard(card.id)"  [disabled]="paying()">
                      @if (paying()) {
                        <div class="d-flex justify-content-around">
                          <span>PROCESSING </span>
  
                        </div>
                        } @else {
                        <span>
                          Continue
                        </span>
                        }
                    </button>
                  </div>
                </div>
                
              </div>
               <div class="d-flex" ><span style="margin: 5px auto; font-size: large;"> OR</span> </div>
         
            </div> -->
            <div *ngIf="this.currSubscription && myCard?.length>0">
              <button (click)="payWithSavedCard()" class="btn btn-success">
                @if (paying()) {
                  <div class="d-flex justify-content-around">
                    <span>PROCESSING </span>

                  </div>
                  } @else {
                  <span>
                    Change Plan
                  </span>
                  }
              </button>
            </div>
          </div>
          <!-- <div class="address" *ngIf="myCard?.length==0" > -->
            <div class="address" >

            <!-- <form [formGroup]="paymentForm" (ngSubmit)="addPaymentInformation()">
          <div class="form-group" >
            <label for="Address" class="form-label">Address</label>
            <input type="text" class="form-control"  formControlName="address" placeholder="Address" >
        </div >
    
          <div class="form-group">
            <label for="phoneNo" class="form-label">City</label>
            <input type="text" class="form-control" formControlName="city" placeholder="City" >
          </div>
          <div class="form-group">
            
            <label for="state">State</label>
                  
              
                    <select class="form-select custom-dropdown" class="form-control" id="state" formControlName="state" #status style="height: fit-content;" >
                      <option value="{{state}}" *ngFor="let state of stateList">{{state}}</option>
                    
                      
                      
                    </select>
          </div>
          <div class="form-group">
            <label for="phoneNo" class="form-label">Zip Code</label>
            <input type="number" class="form-control" formControlName="zipCode" placeholder="Zip Code" >
          </div>
          <div class="form-group">
            <div class="mode">
            <label for="card" class="form-label">
              <input type="radio" formControlName="mode" id="card" value="card">
              Credit or debit card
              <div>
              <img src="assets/mastercard.svg" alt="Mastercard" style="height: 40px; width: 40px;">
              <img src="assets/visa.svg" alt="visa" style="height: 40px; width: 40px;">
              <img src="assets/amex.svg" alt="amex" style="height: 40px; width: 40px;">
              </div>
            
              
            </label>
          </div>
          <br>
          <div class="mode">
          
            <label for="paypal" class="form-label">
              <input type="radio" formControlName="mode" id="card" value="paypal">
              Paypal
              <div>
                <img src="assets/paypal.svg" alt="paypal" style="height: 50px; width: 50px;">
              
                </div>
            </label>
          </div>
          </div>
        
          <button class="btn btn-primary" [disabled]="!paymentForm.valid">Submit</button>
          </form> -->






            <mat-card style="margin: 25px">
              <mat-card-header>
                <mat-card-title style="
                  margin-top: -16px;
                  margin-left: -16px;
                  margin-right: -16px;
                  margin-bottom: 16px;
                 
                ">
                  <mat-toolbar color="primary" style="border-top-right-radius: 4px; border-top-left-radius: 4px;"
                    class="d-flex justify-content-center">
                    Payment Details
                  </mat-toolbar>
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div [formGroup]="checkoutForm">
                  <div style="display: flex; flex-direction: row; gap: 10px">
                    <mat-form-field appearance="outline" style="flex: 1">
                      <mat-label>Name</mat-label>
                      <input matInput formControlName="name" />
                    </mat-form-field>

                  </div>
                  <div style="display: flex; flex-direction: row; gap: 10px">
                    <mat-form-field appearance="outline" style="flex: 1">
                      <mat-label>Address</mat-label>
                      <input matInput formControlName="address" />
                    </mat-form-field>
                  </div>
                  <div style="display: flex; flex-direction: row; gap: 10px">
                    <mat-form-field appearance="outline" style="flex: 1">
                      <mat-label>ZIP Code</mat-label>
                      <input matInput formControlName="zipcode" />
                    </mat-form-field>
                    <mat-form-field appearance="outline" style="flex: 1">
                      <mat-label>State</mat-label>
                      <select matNativeControl formControlName="state" class="form-select custom-dropdown" id="state"
                        #status style="height: fit-content;">
                        <option *ngFor="let state of stateList" [value]="state">{{ state }}</option>
                      </select>
                    </mat-form-field>
                    <mat-form-field appearance="outline" style="flex: 1">
                      <mat-label>City</mat-label>
                      <input matInput formControlName="city" />
                    </mat-form-field>
                  </div>
                  <div style="margin-bottom: 10px"></div>
                  <!-- <ng-container *ngIf="elementsOptions.clientSecret"> -->
                  <!-- <ngx-stripe-elements
                  [stripe]="stripe"
                  [elementsOptions]="elementsOptions"
                >
                  <ngx-stripe-payment />
                </ngx-stripe-elements> -->
                  <ngx-stripe-card #cardElement [options]="cardOptions"></ngx-stripe-card>
                  <!-- </ng-container> -->
                  <div style="margin-bottom: 20px"></div>
                  <mat-divider></mat-divider>
                  <div style="margin-bottom: 20px"></div>
                  <div style="text-align: right">
                    <button mat-stroked-button color="warn" [disabled]="paying()" (click)="clear()"
                      style="margin-right: 16px">
                      CLEAR
                    </button>
                    <!-- <button
                    mat-raised-button
                    color="primary"
                    [disabled]="paying()||this.checkoutForm.invalid"
                    (click)="collectPayment()"
                    
                  > -->
                    <button mat-raised-button color="primary" [disabled]="paying()||this.checkoutForm.invalid"
                      (click)="createSubscription(cardElement)">

                      @if (paying()) {
                      <div class="d-flex justify-content-around">
                        <span>PROCESSING </span>

                      </div>
                      } @else {
                      <span>
                        PAY @if (amount) {
                        <span>{{ amount | currency }}</span>
                        }
                      </span>
                      }
                    </button>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>

          </div>
          
          
        </div>
      </div>

      <div class="payment-success-container" *ngIf="curr_phase==3">
        <!-- Confetti elements -->
        <div class="confetti-container">
          <!-- Repeat .confetti divs for the confetti effect -->
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
        </div>

        <!-- Payment success card -->
        <div class="payment-success-card mat-elevation-z3">
          <div class="icon-container">
            <mat-icon color="primary" class="success-icon">check_circle</mat-icon>
          </div>
          <h2>Payment succeeded!</h2>
          <p>Thank you for processing your most recent payment.</p>
          <p>Your premium subscription will expire on {{ expiryDate | date: 'MMMM d, y' }}.</p>
          <button mat-stroked-button color="primary" (click)="this.goToManageTab()">Your dashboard</button>
        </div>
      </div>

    </div>

    <div *ngIf="currOption==1">
      <div class="d-flex justify-content-center">
        <div class="card" *ngIf="this.currSubscription!=null">
          <div class="logo d-flex justify-content-center" style=" background-color: #bac9bbeb;">
            <div style="display: flex; flex-direction: column;">
              <label class="title">{{this.currSubscription?.plan|titlecase}}</label>
              <label class="price" style="font-weight: 400;">${{this.currSubscription?.amount}}</label>
              <label style="margin: 10px auto; font-size: large;">{{this.currSubscription?.person}} person</label>
              <ng-container *ngIf="this.currSubscription?.expiryDate > this.todayDate; else expiredTemplate">
                
                <!-- <label>
                  Will Expire on {{ this.currSubscription?.expiryDate | date: 'dd/MM/yyyy' }}
                </label> -->
                <label style="display: flex; flex-direction: column;align-items: center; text-align: center;">
                  <span style="font-size: large; font-weight: bold; ">
                    Current Plan
                  </span>
                  
                  <span>  Will Expire on {{ this.currSubscription?.expiryDate | date: 'dd/MM/yyyy' }}</span>
                </label>
              </ng-container>

              <ng-template #expiredTemplate>
                <label>
                  Subscription has expired.
                </label>
              </ng-template>

            </div>
          </div>
          <div class="tab-container">
            <button class="tab tab--1">{{this.currSubscription?.subscriptionPlan}}</button>
          </div>
          <div class="d-flex justify-content-center">
            <button
              style="background-color: #bac9bbeb; border: #bac9bbeb; width: 70%;height: 30px; border-radius: 10px; bottom: 0; margin-bottom: 10px; position: absolute;"
              data-toggle="modal" data-target="#manage">Manage</button>
          </div>
          <div>
            <ul class="lists">
              <li class="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                  viewBox="0 0 16 16">
                  <path
                    d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                </svg>
                <div> Connect 80 websites </div>
              </li>
              <li class="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                  viewBox="0 0 16 16">
                  <path
                    d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                </svg>
                <div> Track up to 50 credit cards </div>
              </li>
              <li class="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                  viewBox="0 0 16 16">
                  <path
                    d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                </svg>
                <div> Export up to 12 months data </div>
              </li>
              <li class="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                  viewBox="0 0 16 16">
                  <path
                    d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                </svg>
                <div> Cloud service 24/7 </div>
              </li>
              <li class="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                  viewBox="0 0 16 16">
                  <path
                    d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                </svg>
                <div> Connect 80 websites </div>
              </li>
              <li class="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                  viewBox="0 0 16 16">
                  <path
                    d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                </svg>
                <div> Connect up to 5 bank accounts </div>
              </li>
            </ul>
          </div>
        </div>


        <div class="card" *ngIf="this.upcomingSubscription!=null">
          <div class="logo d-flex justify-content-center" style=" background-color: #ced4ceeb;">
            <div style="display: flex; flex-direction: column;">
              <label class="title">{{this.upcomingSubscription?.plan|titlecase}}</label>
              <label class="price" style="font-weight: 400;">${{this.upcomingSubscription?.amount}}</label>
              <label style="margin: 10px auto; font-size: large;">{{this.upcomingSubscription?.person}} person</label>
              <ng-container>
                <label style="display: flex; flex-direction: column;align-items: center; text-align: center;">
                  <span style="font-size: large; font-weight: bold; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);">
                    Upcoming Plan
                  </span>
                  
                  <span> Will Start From {{ this.upcomingSubscription?.subscriptionDate | date: 'dd/MM/yyyy' }}</span>
                </label>
              </ng-container>



            </div>
          </div>
          <div class="tab-container">
            <button class="tab tab--1">{{this.upcomingSubscription?.subscriptionPlan}}</button>
          </div>
          
        
          
         
          <div>
            
            <ul class="lists">
              <li class="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                  viewBox="0 0 16 16">
                  <path
                    d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                </svg>
                <div> Connect 80 websites </div>
              </li>
              <li class="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                  viewBox="0 0 16 16">
                  <path
                    d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                </svg>
                <div> Track up to 50 credit cards </div>
              </li>
              <li class="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                  viewBox="0 0 16 16">
                  <path
                    d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                </svg>
                <div> Export up to 12 months data </div>
              </li>
              <li class="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                  viewBox="0 0 16 16">
                  <path
                    d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                </svg>
                <div> Cloud service 24/7 </div>
              </li>
              <li class="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                  viewBox="0 0 16 16">
                  <path
                    d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                </svg>
                <div> Connect 80 websites </div>
              </li>
              <li class="list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check"
                  viewBox="0 0 16 16">
                  <path
                    d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z" />
                </svg>
                <div> Connect up to 5 bank accounts </div>
              </li>
            </ul>
          </div>

          <div style="position: relative; height: 100px;">
            <div
              *ngIf="upcomingSubscription?.subscriptionPlan == currSubscription?.subscriptionPlan&&upcomingSubscription?.person>currSubscription?.person"
              style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
              
              <button
                style="background-color: #bac9bbeb; border: #ced4ceeb; width: 80%; height: 30px; border-radius: 10px;"
                data-toggle="modal" data-target="#startUpcomingSubscription">
                Start
              </button>
          
              <button
                style="background-color: #bac9bbeb; border: #ced4ceeb; width: 80%; height: 30px; border-radius: 10px;"
                data-toggle="modal" data-target="#deleteUpcomingSubscription">
                Cancel
              </button>
          
            </div>
          
            <button
              *ngIf="upcomingSubscription?.subscriptionPlan != currSubscription?.subscriptionPlan||upcomingSubscription?.person<=currSubscription?.person"
              style="background-color: #bac9bbeb; border: #ced4ceeb; width: 80%; height: 30px; border-radius: 10px;
                     position: absolute; bottom: 0; left: 10%;; margin-bottom: 10px;" 
              data-toggle="modal" data-target="#deleteUpcomingSubscription">
              Cancel
            </button>
          </div>
          
        </div>
      </div>



      <h2 class="d-flex justify-content-center" *ngIf="this.currSubscription==null">
        No Subscription
      </h2>
      <div class="billing-details" *ngIf="this.currSubscription!=null">

        <div class="addCardsDetails">
          <div style="padding: 10px;" *ngIf="!this.upcomingSubscription; else currentPlan">
            <div class="d-flex justify-content-between" style="padding: 10px;">
              <h2>Current Billing Details</h2>
              <span style="font-size: larger; ">Next Billing: <span
                  style="font-size: x-large;height: 10px; font-weight: bold;">${{this.currSubscription?.amount|
                  number:'1.2-2'}}</span></span>
            </div>
            <div style="font-size:large; padding: 10px;" class="d-flex justify-content-between">
              <span>{{ this.currSubscription?.subscriptionDate | date:'d MMMM, YYYY' }} - {{
                this.currSubscription?.expiryDate | date:'d MMMM, YYYY' }}</span>
              <span> {{ this.currSubscription?.expiryDate| date:'d MMMM, YYYY' }}</span>
            </div>

          </div>
          <ng-template #currentPlan>
            <div style="padding: 10px;" >
              <div class="d-flex justify-content-between" style="padding: 10px;">
                <h2>Current Billing Details</h2>
                <span style="font-size: larger; ">Next Billing: <span
                    style="font-size: x-large;height: 10px; font-weight: bold;">${{this.upcomingSubscription?.amount|
                    number:'1.2-2'}}</span></span>
              </div>
              <div style="font-size:large; padding: 10px;" class="d-flex justify-content-between">
                <span>{{ this.currSubscription?.subscriptionDate | date:'d MMMM, YYYY' }} - {{
                  this.currSubscription?.expiryDate | date:'d MMMM, YYYY' }}</span>
                <span> {{ this.currSubscription?.expiryDate| date:'d MMMM, YYYY' }}</span>
              </div>
            </div>
          </ng-template>
         
          <button class="btn btn-primary" (click)="addCard()" id="card-add-btn" *ngIf="!myCard?.length">Add
            Card</button>
          <div id="add-card-div" *ngIf="displayAddCard">
            <div>
              <button (click)="closeAddCard()"
                style="display: flex; place-self: end; border: 0.5px solid lightgray; border-radius: 5px;">&times;</button>
            </div>
            <!-- <form [formGroup]="cardDetails" (ngSubmit)="addCardDetails()">
            <div class="row">
              <div class="form-group col-md-6">
                <label for="firstName" class="form-label">First Name</label>
                <input type="text" class="form-control" formControlName="firstName" placeholder="Zhang" />
              </div>
              <div class="form-group col-md-6">
                <label for="lastName" class="form-label">Last Name</label>
                <input type="text" class="form-control" formControlName="lastName" placeholder="San" />
              </div>
            </div>
          
    
            <div class="form-group">
              <label for="cardNumber" class="form-label">Card Details</label>
              <ngx-stripe-card  #cardElement [options]="cardOptions"></ngx-stripe-card>
            </div>
          
            <button class="btn btn-success" style="margin: 8px auto; display: flex;" >
              Save
            </button>
          </form> -->

            <!-- <form [formGroup]="cardDetails" (ngSubmit)="addCardDetails()">
            <div class="row">
              <div class="form-group col-md-6">
                <label for="firstName" class="form-label">First Name</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="firstName"
                  placeholder="Zhang"
                />
              </div>
              <div class="form-group col-md-6">
                <label for="lastName" class="form-label">Last Name</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="lastName"
                  placeholder="San"
                />
              </div>
            </div>
            <div class="form-group">
              <label for="cardNumber" class="form-label">Card Number</label>
              <input
                type="text"
                class="form-control"
                formControlName="cardNumber"
                placeholder="0000 0000 0000 0000"
                (input)="formatSavedCardNumber($event)"
                maxlength="19"
              />
            </div>
            <div class="row">
              <div class="form-group col-md-6">
                <label for="expiry" class="form-label">Expiry Date</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="expiry"
                  (input)="formatExpiry($event)"
                  maxlength="5"
                  placeholder="MM/YY"
                />
              </div>
              <div class="form-group col-md-6">
                <label for="cvv" class="form-label">CVV</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="cvv"
                  placeholder="123"
                  maxlength="3"
                />
              </div>
            </div>
            <button
              class="btn btn-success"
              style="margin: 8px auto; display: flex;"
              [disabled]="!cardDetails.valid"
            >
              Save
            </button>
          </form> -->

            <!-- <form (submit)="validateCard($event)">
            <ngx-stripe-card #cardElement [options]="cardOptions"></ngx-stripe-card>
            <button type="submit">Validate Card</button>
          </form>
          <p *ngIf="cardError" style="color: red">{{ cardError }}</p> -->

            <input type="text" style="width: 100%; border-radius: 5px; border: 0.5px solid lightgray; height: 30px;"
              [(ngModel)]="cardholderName" placeholder="Cardholder Name" />

            <ngx-stripe-card #cardElement [options]="cardOptions"></ngx-stripe-card>

            <button class="btn btn-primary" (click)="saveCard(cardElement, cardholderName)" [disabled]="savingCard()">

              @if (savingCard()) {
              <div class="d-flex justify-content-around">
                <span>SAVING </span>

              </div>
              } @else {
              <span>
                SAVE
              </span>
              }
            </button>




          </div>
          <div class="savedCard d-flex justify-content-center" *ngIf="myCard?.length&&showSavedCard">
            <div>
              <h2>Saved Card</h2>
              <div id="card-span" class="d-flex justify-content-between" *ngIf="!editCard">
                <div *ngFor="let card of myCard">
                  <div>
                    <div>
                      <span>
                        <img [src]="getCardLogo(card?.brand)" alt="{{ card?.brand }}" class="card-logo" />
                        ending in {{ card?.last4 }}
                      </span>
                    </div>
                    <div style="color: gray; font-weight: 400; font-size: small;">
                      <span>Expiry Date: </span> {{ ('0' + (card?.expMonth || 0)).slice(-2) }} / {{ card?.expYear }}
                    </div>
                  </div>
                </div>
                <div>
                  <i class="bi bi-chevron-right" style="margin-top:20px;" (click)="editCardFunc(myCard?.[0]?.id)"></i>
                </div>
              </div>

              <div id="edit-card-span" *ngIf="editCard">
                <div *ngFor="let card of myCard">
                  <div>
                    <span>
                      <img [src]="getCardLogo(card?.brand)" alt="{{ card?.brand }}" class="card-logo" />
                      ending in {{ card?.last4 }}
                    </span>
                  </div>
                  <div style="color: gray; font-weight: 400; font-size: small;">
                    <span>Expiry Date: </span> {{ ('0' + (card?.expMonth || 0)).slice(-2) }} / {{ card?.expYear }}
                  </div>
                  <div style="display: flex; justify-content: center; margin-top: 20px; font-size: small;">
                    <button class="btn btn-primary btn-sm" style="margin: 10px;"
                      (click)="deleteCardBack()">Back</button>
                    <button class="btn btn-danger btn-sm" style="margin: 10px;"
                      (click)="editSaveCard(card?.id)">Edit</button>
                  </div>
                </div>
              </div>
             
            </div>
          </div>


        </div>

      </div>



      <!-- <div class=" d-flex justify-content-center" style="margin-top: 50px; width:100% ;" *ngIf="curr_phase==8" >
  
    <div  style="margin-right: 30px;display: flex; justify-content:center; display: flex; flex: none;">
      <a  (click)="onBack()" style="margin-right: 30px; font-size: large; font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;" id="subscription-back" >&larr; Back</a>
     
    </div>
    <div>
      <h1>Payment</h1>
      <div style="width: 50vw; border: 1px solid lightgray; background-color: white; padding: 30px 10px; border-radius: 10px;" class="card-details-form mat-elevation-z2 p-4 ">
      
        
        <form (ngSubmit)="createToken()">
          <ngx-stripe-card [options]="cardOptions"  [elementsOptions]="elementsOptions" #card></ngx-stripe-card>
          <button type="submit" class="btn btn-primary">Pay {{ res_amount }} USD</button>
        </form>
    
      <button class="btn btn-primary" (click)="confirmPayment()">Pay </button>
        
        
      </div>
    </div>
  </div> -->
      <div class="invoice-details">
        <h1 style="margin: 10px;">Invoice</h1>
        <table class="table" id="invoice-table">
          <thead class="table-dark">
            <tr>

              <th scope="col">Date</th>
              <th scope="col">Invoice#</th>

              <th scope="col">Payment Status</th>
              <th scope="col">Amount</th>
              <th></th>

            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of InvoiceList" bi bi-download>

              <td>{{item.transactionDate|date }}</td>
              <td>{{item.id}}</td>
              <td >
                <div [ngClass]="getPaymentStatusClass(item.paymentStatus)">
                  {{ item.paymentStatus }}
                </div>
               
              </td>
              <td>$ {{item.amount| number:'1.2-2'}}</td>

              <td>

                <!-- <img src="../../../assets/edit.svg" id="edit-button" [ngClass]="{'editoption':!(editVisibility&&(editButtonId==assetListWithExtraFields.indexOf(item)+1))}" style="float: inline-start; height: 25px; width: 25px;" (click)="changeAssetDetails(item)"> -->
                <i class="bi bi-download" 
                style="float: inline-start; font-size: 20px; cursor: pointer;" 
                (click)="downloadInvoice(item)">
                </i>
             

                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16" style="margin-top: 20px; color:gray " [ngClass]="{'editoption':!(editVisibility&&(editButtonId==assetListWithExtraFields.indexOf(item)+1))}" (click)="changeAssetDetails(item)" >
                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325"/>
              </svg> -->
              </td>

            </tr>


          </tbody>
        </table>

      </div>



    </div>


    <div class="modal fade" id="addPerson" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="exampleModalLongTitle">Total Amount</h2>
            <button type="button" class="close  ms-auto" (click)="closeAddPlan()"  #closeBox>
              <div aria-hidden="true">&times;</div>
            </button>
          </div>
          <div class="modal-body">
            <table style="width: 100%;">
              <thead>
                <th style="text-align: center;">Total Person</th>
                <th style="text-align: center;">Subscription Type</th>
                <th style="text-align: center;">Amount</th>
                <th style="text-align: center;">Duration</th>
              </thead>
              <tbody>
                <tr>
                  <td style="text-align: center;">Person <button class="btn btn-light plus-minus-btn"
                      (click)="removePerson()">
                      <div class="plus-minus">-</div>
                    </button><button class="btn btn-light">{{person}}</button><button
                      class="btn btn-light plus-minus-btn" (click)="addPerson()">
                      <div class="plus-minus">+</div>
                    </button> </td>
                  <td style="text-align: center;">
                    <div style=" background-color:#bac9bbeb; padding: 10px 10px; border-radius: 10px; ">Basic</div>
                  </td>
                  <td style="text-align: center; font-size: 18px ;" *ngIf="basicIsMonthly">${{person*curr_amount}}</td>
                  <td style="text-align: center; font-size: 18px ;" *ngIf="!basicIsMonthly">${{person*curr_amount*12}}
                  </td>
                  <td style="text-align: center; font-size: 15px ;" *ngIf="basicIsMonthly">1 month</td>
                  <td style="text-align: center; font-size: 15px ;" *ngIf="!basicIsMonthly">1 year</td>
                </tr>

              </tbody>
            </table>
            <!-- <button class="btn btn-light plus-minus-btn" (click)="removePerson()" ><div class="plus-minus">-</div></button><input type="number" style="width: 50px;" min=1 [(ngModel)]="person"><button class="btn btn-light plus-minus-btn" (click)="addPerson()"><div class="plus-minus" >+</div></button> -->
            <!-- <button class="btn btn-light plus-minus-btn" (click)="removePerson()" ><div class="plus-minus">-</div></button><button class="btn btn-light" >{{person}}</button><button class="btn btn-light plus-minus-btn" (click)="addPerson()"><div class="plus-minus" >+</div></button>  -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="closeBox.click()">Cancel</button>
            <button type="button" class="btn btn-primary" (click)="proceed()"
              (click)="closeBox.click()">Proceed</button>
          </div>
        </div>
      </div>
    </div>


    <div class="modal fade" id="deleteUpcomingSubscription" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="exampleModalLongTitle">Are you Sure You Want to Cancel Upcoming Subscription</h2>
            <button type="button" class="close  ms-auto" data-dismiss="modal" aria-label="Close" #closeBox>
              <div aria-hidden="true">&times;</div>
            </button>
          </div>
          <!-- <div class="modal-body">
            
            <button class="btn btn-light plus-minus-btn" (click)="removePerson()" ><div class="plus-minus">-</div></button><input type="number" style="width: 50px;" min=1 [(ngModel)]="person"><button class="btn btn-light plus-minus-btn" (click)="addPerson()"><div class="plus-minus" >+</div></button>
            <button class="btn btn-light plus-minus-btn" (click)="removePerson()" ><div class="plus-minus">-</div></button><button class="btn btn-light" >{{person}}</button><button class="btn btn-light plus-minus-btn" (click)="addPerson()"><div class="plus-minus" >+</div></button>  -->
          <!-- </div> -->
          <div class="modal-footer">
            <button class="btn btn-danger" (click)="deleteUpcomingPlan()" (click)="closeBox.click()" data-dismiss="modal">Delete</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            
        </div>
      </div>
    </div>



  </div>

  <div class="modal fade" id="startUpcomingSubscription" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="exampleModalLongTitle">Are you Sure You Want to Start Upcoming Subscription</h2>
            <button type="button" class="close  ms-auto" data-dismiss="modal" aria-label="Close" #closeBox>
              <div aria-hidden="true">&times;</div>
            </button>
          </div>
          <!-- <div class="modal-body">
            
            <button class="btn btn-light plus-minus-btn" (click)="removePerson()" ><div class="plus-minus">-</div></button><input type="number" style="width: 50px;" min=1 [(ngModel)]="person"><button class="btn btn-light plus-minus-btn" (click)="addPerson()"><div class="plus-minus" >+</div></button>
            <button class="btn btn-light plus-minus-btn" (click)="removePerson()" ><div class="plus-minus">-</div></button><button class="btn btn-light" >{{person}}</button><button class="btn btn-light plus-minus-btn" (click)="addPerson()"><div class="plus-minus" >+</div></button>  -->
          <!-- </div> -->
          <div class="modal-footer">
            <button class="btn btn-success" (click)="startUpcomingPlan()" data-dismiss="modal">Start</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            
        </div>
      </div>
    </div>



  </div>

  